<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŠ¤ë§ˆíŠ¸ í‚¤ì˜¤ìŠ¤í¬ í”„ë¡œí† íƒ€ì…</title>
    <style>
        /* ì„¸ë¡œí˜• í‚¤ì˜¤ìŠ¤í¬ í•´ìƒë„ ëŒ€ì‘ (Full HD Portrait) */
        :root {
            --primary-color: rgba(10,103,166,100);
            --accent-color: #ffc107;
            --bg-color: #f4f4f4;
        }

        body {
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            background-color: var(--bg-color);
            font-family: 'Noto Sans KR', sans-serif;
            overflow: hidden; /* ìŠ¤í¬ë¡¤ ë°©ì§€ */
            display: flex;
            flex-direction: column;
        }

        /* ê³µí†µ í—¤ë” */
        header {
            background: var(--primary-color);
            color: white;
            padding: 40px;
            text-align: center;
            font-size: 2.5rem;
            font-weight: bold;
        }

        /* ë©”ì¸ ì»¨í…ì¸  ì˜ì—­ */
        main {
            flex: 1;
            padding: 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        /* í™”ë©´ ì „í™˜ìš© ì„¹ì…˜ë“¤ */
        section {
            display: none; /* ê¸°ë³¸ ìˆ¨ê¹€ */
            width: 100%;
            height: 100%;
            flex-direction: column;
            align-items: center;
        }

        section.active {
            display: flex; /* í™œì„±í™”ëœ í˜ì´ì§€ë§Œ í‘œì‹œ */
        }

        /* UI ì»´í¬ë„ŒíŠ¸: ë²„íŠ¼ */
        .btn {
            background: white;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            padding: 30px 60px;
            font-size: 2rem;
            border-radius: 20px;
            margin: 20px;
            cursor: pointer;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            transition: 0.2s;
        }

        .btn:active {
            transform: scale(0.95);
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        /* ì¡¸ì—… ìš”ê±´ ê·¸ë˜í”„ ìŠ¤íƒ€ì¼ */
        .progress-container {
            width: 90%;
            margin: 30px 0;
        }
        .progress-label {
            font-size: 1.5rem;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
        }
        .progress-bar {
            width: 100%;
            height: 30px;
            background-color: #ddd;
            border-radius: 15px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background-color: var(--primary-color);
            width: 0%; /* JSë¡œ ì œì–´ */
            transition: width 1s ease-in-out;
        }

        /* ê²°ì„ê³„ ì¹´ë©”ë¼ ë° ì„œëª… */
        #camera-feed {
            width: 100%;
            background: #000;
            object-fit: cover;
            border-radius: 20px;
        }
        
        canvas {
            border: 2px dashed #999;
            background: white;
            border-radius: 10px;
            cursor: crosshair;
        }




        /* --- ë‚ ì§œ ë° ê³¼ëª© ì„ íƒ UI ìŠ¤íƒ€ì¼ --- */
        .date-picker-container {
            margin-bottom: 20px;
            width: 90%;
        }

        input[type="date"] {
            font-size: 1.5rem;
            padding: 15px;
            width: 100%;
            border: 2px solid var(--primary-color);
            border-radius: 10px;
            font-family: inherit;
            box-sizing: border-box; /* íŒ¨ë”© í¬í•¨ í¬ê¸° ê³„ì‚° */
        }

        /* ìˆ˜ì—… ëª©ë¡ ì»¨í…Œì´ë„ˆ */
        #class-list-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 90%;
            margin-bottom: 30px;
            max-height: 300px;
            overflow-y: auto; /* ìˆ˜ì—…ì´ ë§ìœ¼ë©´ ìŠ¤í¬ë¡¤ */
        }

        /* ê°œë³„ ìˆ˜ì—… ì¹´ë“œ (ë²„íŠ¼ ì—­í• ) */
        .class-item {
            background: white;
            border: 2px solid #ddd;
            border-radius: 15px;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        /* ìˆ˜ì—… ì„ íƒë˜ì—ˆì„ ë•Œ ìŠ¤íƒ€ì¼ */
        .class-item.selected {
            border-color: var(--primary-color);
            background-color: #e3f2fd; /* ì—°í•œ íŒŒë€ìƒ‰ */
            box-shadow: 0 4px 8px rgba(0, 86, 179, 0.2);
        }

        .class-item .time {
            font-weight: bold;
            color: #555;
            font-size: 1.2rem;
        }

        .class-item .name {
            font-size: 1.4rem;
            font-weight: bold;
            color: #333;
        }

        .class-item .check-icon {
            font-size: 1.5rem;
            color: transparent; /* ê¸°ë³¸ì€ ì•ˆë³´ì„ */
        }

        .class-item.selected .check-icon {
            color: var(--primary-color); /* ì„ íƒë˜ë©´ ë³´ì„ */
        }
    </style>
</head>
<body>

    <header>ë™ì–‘ë¯¸ë˜ëŒ€í•™êµ ìŠ¤ë§ˆíŠ¸ í‚¤ì˜¤ìŠ¤í¬</header>

    <main>
        <section id="page-idle" class="active">
            <div style="font-size: 3rem; margin-bottom: 50px;">í•™ìƒì¦ì„ íƒœê·¸í•´ì£¼ì„¸ìš”</div>
            <div style="width: 300px; height: 300px; background: #ddd; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                <span style="font-size: 5rem;">ğŸ’³</span>
            </div>
            <button class="btn btn-primary" onclick="simulateLogin()">[TEST] RFID í•™ìƒì¦ íƒœê·¸ ì‹œë®¬ë ˆì´ì…˜</button>
        </section>

        <section id="page-menu">
            <h1 id="user-greeting">ë°˜ê°‘ìŠµë‹ˆë‹¤, 000ë‹˜</h1>
            <div style="display: grid; grid-template-columns: 1fr; gap: 20px; width: 80%;">
                <button class="btn" onclick="showGraduation()">ğŸ“ ì¡¸ì—… ìš”ê±´ í™•ì¸</button>
                <button class="btn" onclick="showAbsence()">ğŸ“ ì „ì ê²°ì„ê³„ ì‘ì„±</button>
                <button class="btn" style="background:#666; color:white;" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </section>

        <section id="page-graduation">
            <h2>ë‚˜ì˜ ì¡¸ì—… ë‹¬ì„±ë„</h2>
            <div id="charts-area" style="width: 100%;">
                </div>
            <button class="btn" onclick="goBack()">ë’¤ë¡œ ê°€ê¸°</button>
        </section>

        <section id="page-absence">
            <h2 style="margin-bottom: 10px;">ì „ì ê²°ì„ê³„ ì œì¶œ</h2>
            
            <div style="width: 100%; display:flex; flex-direction:column; align-items:center;">
                <div class="date-picker-container">
                    <label style="display:block; margin-bottom:10px; font-weight:bold;">ê²°ì„ ì¼ì ì„ íƒ</label>
                    <input type="date" id="absence-date" onchange="loadClassesForDate()">
                </div>

                <div id="class-list-container">
                    </div>
            </div>

            <div style="width: 90%; margin-bottom: 20px; border-top: 1px solid #ccc; padding-top: 20px;">
                <h3>ì¦ë¹™ì„œë¥˜ ë° ì„œëª…</h3>
                
                <div style="margin-bottom: 15px;">
                    <video id="camera-feed" autoplay playsinline style="height: 200px;"></video>
                    <button class="btn" style="padding: 10px 20px; font-size: 1.2rem;" onclick="captureDoc()">ğŸ“¸ ì„œë¥˜ ì´¬ì˜</button>
                </div>

                <canvas id="sign-pad" width="600" height="150" style="width:100%; height:150px;"></canvas>
                
                <div style="margin-top: 20px; display: flex; justify-content: space-between;">
                    <button class="btn" onclick="goBack()" style="flex:1; margin: 5px; background:#666; color:white;">ì·¨ì†Œ</button>
                    <button class="btn btn-primary" onclick="submitAbsence()" style="flex:2; margin: 5px;">ì œì¶œí•˜ê¸°</button>
                </div>
            </div>
        </section>
    </main>

    <script>
        // --- 1. Mock Data (ë°±ì—”ë“œ ë°ì´í„° í‰ë‚´) ---
        const mockUser = {
            name: "ê¹€ë©ë©",
            id: "20231234",
            major: "ì»´í“¨í„°ì†Œí”„íŠ¸ì›¨ì–´ê³µí•™ê³¼",
            graduation: {
                total: { current: 100, required: 130 },
                major: { current: 60, required: 70 },
                general: { current: 40, required: 50 }
            }
        };

        // --- 2. í™”ë©´ ì „í™˜ ë¡œì§ ---
        function navigateTo(pageId) {
            document.querySelectorAll('section').forEach(sec => sec.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
        }

        function simulateLogin() {
            // ì‹¤ì œë¼ë©´ ì—¬ê¸°ì„œ API í˜¸ì¶œ
            document.getElementById('user-greeting').innerText = `ë°˜ê°‘ìŠµë‹ˆë‹¤, ${mockUser.name} í•™ìš°ë‹˜`;
            navigateTo('page-menu');
        }

        function goBack() {
            navigateTo('page-menu');
        }

        function logout() {
            // ì´ˆê¸°í™” ë¡œì§
            navigateTo('page-idle');
        }

        // --- 3. ì¡¸ì—… ìš”ê±´ ê¸°ëŠ¥ (ì°¨íŠ¸ ë Œë”ë§) ---
        function showGraduation() {
            const container = document.getElementById('charts-area');
            container.innerHTML = ''; // ì´ˆê¸°í™”

            const data = mockUser.graduation;
            const items = [
                { label: "ì´ í•™ì ", curr: data.total.current, req: data.total.required },
                { label: "ì „ê³µ í•™ì ", curr: data.major.current, req: data.major.required },
                { label: "êµì–‘ í•™ì ", curr: data.general.current, req: data.general.required }
            ];

            items.forEach(item => {
                const percent = Math.min((item.curr / item.req) * 100, 100);
                const html = `
                    <div class="progress-container">
                        <div class="progress-label">
                            <span>${item.label}</span>
                            <span>${item.curr} / ${item.req} (${Math.round(percent)}%)</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${percent}%"></div>
                        </div>
                    </div>
                `;
                container.innerHTML += html;
            });

            navigateTo('page-graduation');
        }

        // --- 4. ì „ì ê²°ì„ê³„ ê¸°ëŠ¥ (ì¹´ë©”ë¼ & ì„œëª…) ---
        let videoStream = null;

        function showAbsence() {
            navigateTo('page-absence');
            initCamera();
            initSignaturePad();
        }

        // ì¹´ë©”ë¼ ì´ˆê¸°í™” (Web API)
        async function initCamera() {
            const video = document.getElementById('camera-feed');
            try {
                // í›„ë©´ ì¹´ë©”ë¼ ìš°ì„  ìš”ì²­ (ëª¨ë°”ì¼/í‚¤ì˜¤ìŠ¤í¬ í™˜ê²½)
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: "environment" } 
                });
                video.srcObject = stream;
                videoStream = stream;
            } catch (err) {
                console.error("ì¹´ë©”ë¼ ì ‘ê·¼ ì‹¤íŒ¨:", err);
                alert("ì¹´ë©”ë¼ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (HTTPS í™˜ê²½ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”)");
            }
        }

        function captureDoc() {
            alert("ì¦ë¹™ ì„œë¥˜ê°€ ì´ë¯¸ì§€ë¡œ ìº¡ì²˜ë˜ì—ˆìŠµë‹ˆë‹¤. (ê°€ìƒ ë™ì‘)");
            // ì‹¤ì œ êµ¬í˜„ì‹œ: Canvasì— video í”„ë ˆì„ì„ ê·¸ë ¤ì„œ ì´ë¯¸ì§€ ë°ì´í„°(Base64)ë¡œ ë³€í™˜
        }

        // ì„œëª… íŒ¨ë“œ (Canvas API)
        let isDrawing = false;
        let canvas, ctx;

        function initSignaturePad() {
            canvas = document.getElementById('sign-pad');
            ctx = canvas.getContext('2d');
            ctx.lineWidth = 3;
            ctx.lineCap = 'round';
            ctx.strokeStyle = '#000';

            // ë§ˆìš°ìŠ¤/í„°ì¹˜ ì´ë²¤íŠ¸ ë°”ì¸ë”©
            canvas.addEventListener('mousedown', startDraw);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', endDraw);
            canvas.addEventListener('touchstart', (e) => startDraw(e.touches[0]));
            canvas.addEventListener('touchmove', (e) => {
                e.preventDefault(); // ìŠ¤í¬ë¡¤ ë°©ì§€
                draw(e.touches[0]);
            });
            canvas.addEventListener('touchend', endDraw);
        }

        function startDraw(e) {
            isDrawing = true;
            ctx.beginPath();
            const rect = canvas.getBoundingClientRect();
            ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
        }

        function draw(e) {
            if (!isDrawing) return;
            const rect = canvas.getBoundingClientRect();
            ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
            ctx.stroke();
        }

        function endDraw() {
            isDrawing = false;
        }

        function clearSign() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        function submitAbsence() {
            alert("ê²°ì„ê³„ê°€ í–‰ì •ì‹¤ë¡œ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤!");
            // ì‹¤ì œ êµ¬í˜„ì‹œ: ìº¡ì²˜ëœ ì´ë¯¸ì§€ + ì„œëª… ë°ì´í„° + í¼ ë°ì´í„°ë¥¼ JSONìœ¼ë¡œ ë¬¶ì–´ ì„œë²„ ì „ì†¡
            goBack();
        }


        const mockSchedule = {
            // 0: ì¼, 1: ì›”, 2: í™” ...
            1: [ // ì›”ìš”ì¼
                { id: 'mon1', time: '09:00 - 10:30', name: 'ìë£Œêµ¬ì¡°' },
                { id: 'mon2', time: '10:30 - 12:00', name: 'ì»´í“¨í„°êµ¬ì¡°' },
                { id: 'mon3', time: '13:00 - 15:00', name: 'ëŒ€í•™ì˜ì–´' }
            ],
            2: [ // í™”ìš”ì¼
                { id: 'tue1', time: '14:00 - 16:00', name: 'ì›¹í”„ë¡œê·¸ë˜ë°' },
                { id: 'tue2', time: '16:00 - 18:00', name: 'ìš´ì˜ì²´ì œ' }
            ],
            3: [ // ìˆ˜ìš”ì¼
                { id: 'wed1', time: '09:00 - 12:00', name: 'ìº¡ìŠ¤í†¤ë””ìì¸' }
            ],
            4: [ // ëª©ìš”ì¼
                { id: 'thu1', time: '09:00 - 10:30', name: 'ìë£Œêµ¬ì¡°' },
                { id: 'thu2', time: '10:30 - 12:00', name: 'ì»´í“¨í„°êµ¬ì¡°' }
            ],
            5: [ // ê¸ˆìš”ì¼
                { id: 'fri1', time: '10:00 - 13:00', name: 'ì¸ê³µì§€ëŠ¥ê°œë¡ ' }
            ]
        };

        let selectedClassIds = []; // ì„ íƒëœ ìˆ˜ì—… ID ì €ì¥

        // --- ê²°ì„ê³„ í™”ë©´ ì§„ì… ì‹œ ì´ˆê¸°í™” ---
        function showAbsence() {
            navigateTo('page-absence');
            
            // 1. ë‚ ì§œë¥¼ 'ì˜¤ëŠ˜'ë¡œ ê¸°ë³¸ ì„¤ì •
            const today = new Date();
            const dateStr = today.toISOString().split('T')[0]; // YYYY-MM-DD í˜•ì‹
            const dateInput = document.getElementById('absence-date');
            dateInput.value = dateStr;

            // 2. ì˜¤ëŠ˜ ë‚ ì§œ ê¸°ì¤€ ìˆ˜ì—… ë¡œë“œ
            loadClassesForDate();

            // 3. ì¹´ë©”ë¼ ë° ì„œëª… ì´ˆê¸°í™” (ê¸°ì¡´ í•¨ìˆ˜ ì¬ì‚¬ìš©)
            initCamera();
            initSignaturePad();
        }

        // --- ë‚ ì§œ ë³€ê²½ ì‹œ ìˆ˜ì—… ëª©ë¡ ë¡œë“œ ---
        function loadClassesForDate() {
            const dateInput = document.getElementById('absence-date');
            const listContainer = document.getElementById('class-list-container');
            const dateObj = new Date(dateInput.value);
            const dayOfWeek = dateObj.getDay(); // 0(ì¼) ~ 6(í† )

            selectedClassIds = []; // ì„ íƒ ì´ˆê¸°í™”
            listContainer.innerHTML = ''; // ëª©ë¡ ë¹„ìš°ê¸°

            const classes = mockSchedule[dayOfWeek];

            if (!classes || classes.length === 0) {
                listContainer.innerHTML = '<div style="text-align:center; padding:20px; color:#666;">í•´ë‹¹ ë‚ ì§œì—ëŠ” ìˆ˜ì—…ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            // ìˆ˜ì—… ëª©ë¡ ìƒì„±
            classes.forEach(cls => {
                const item = document.createElement('div');
                item.className = 'class-item';
                item.onclick = () => toggleClassSelection(item, cls.id); // í´ë¦­ ì´ë²¤íŠ¸ ì—°ê²°
                
                item.innerHTML = `
                    <div>
                        <div class="time">${cls.time}</div>
                        <div class="name">${cls.name}</div>
                    </div>
                    <div class="check-icon">âœ”</div>
                `;
                listContainer.appendChild(item);
            });
        }

        // --- ìˆ˜ì—… ì„ íƒ/í•´ì œ í† ê¸€ ë¡œì§ ---
        function toggleClassSelection(element, classId) {
            if (selectedClassIds.includes(classId)) {
                // ì´ë¯¸ ì„ íƒë¨ -> í•´ì œ
                selectedClassIds = selectedClassIds.filter(id => id !== classId);
                element.classList.remove('selected');
            } else {
                // ì„ íƒ ì•ˆë¨ -> ì„ íƒ
                selectedClassIds.push(classId);
                element.classList.add('selected');
            }
        }

        // --- ì œì¶œ ë²„íŠ¼ ìˆ˜ì • ---
        function submitAbsence() {
            // ìœ íš¨ì„± ê²€ì‚¬
            if (selectedClassIds.length === 0) {
                alert("ê²°ì„í•œ ìˆ˜ì—…ì„ ìµœì†Œ í•˜ë‚˜ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”.");
                return;
            }
            
            // (ì—¬ê¸°ì„œ ì„œëª… ì—¬ë¶€ë‚˜ ì‚¬ì§„ ì—¬ë¶€ë„ ì²´í¬ ê°€ëŠ¥)

            // ì œì¶œ ì™„ë£Œ ë©”ì‹œì§€
            const date = document.getElementById('absence-date').value;
            alert(`[${date}] ë‚ ì§œì˜ ìˆ˜ì—… ${selectedClassIds.length}ê±´ì— ëŒ€í•œ\nê²°ì„ê³„ê°€ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤.`);
            
            // ì´ˆê¸°í™” ë° ë’¤ë¡œê°€ê¸°
            selectedClassIds = [];
            goBack();
        }
    </script>
</body>
</html>